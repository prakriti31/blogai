<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recommended for You</title>
    <link rel="stylesheet" href="/css/home-style.css" />
    <link rel="stylesheet" href="/css/recommendation.css" />
    <script src="https://kit.fontawesome.com/eabac940d1.js" crossorigin="anonymous"></script>
</head>
<body>
<!-- NAVBAR -->
<nav>â€¦</nav>

<main class="recommendations-container">
    <section id="restaurants" class="section">
        <h2>Restaurants</h2>
        <div class="cards-container"></div>
    </section>
    <section id="musicalEvents" class="section">
        <h2>Musical Events</h2>
        <div class="cards-container"></div>
    </section>
    <section id="sportsEvents" class="section">
        <h2>Sports Events</h2>
        <div class="cards-container"></div>
    </section>
</main>

<script>
    // Use browser geolocation instead of ipapi.co
    document.addEventListener('DOMContentLoaded', () => {
        if (!navigator.geolocation) {
            alert('Geolocation not supported');
            return;
        }
        navigator.geolocation.getCurrentPosition(async ({ coords }) => {
            const { latitude, longitude } = coords;

            // weather API à¤œà¥ˆà¤¸à¤¾ à¤ªà¤¹à¤²à¥‡
            const weatherRes = await fetch(
                `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`
            );
            const weatherData = await weatherRes.json();
            const weather = weatherData.current_weather;

            // à¤…à¤¬ POST à¤•à¤°à¥‹
            console.log("â†’ Sending POST /api/recommendations with", { latitude, longitude, weather });
            const recRes = await fetch('/api/recommendations', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    location: `${latitude},${longitude}`,
                    weather
                })
            });

            if (!recRes.ok) {
                console.error("API responded with status", recRes.status);
                return;
            }

            const { recommendations } = await recRes.json();
            console.log("ðŸ”” Received recommendations:", recommendations);

            // à¤«à¤¿à¤° render à¤•à¤°à¥‹
            renderCards('restaurants',    recommendations.restaurants,    weather);
            renderCards('musicalEvents', recommendations.musicalEvents, weather);
            renderCards('sportsEvents',   recommendations.sportsEvents,   weather);
        }, err => {
            console.error('Geolocation error', err);
        });
    });

    function renderCards(sectionId, items, weather) {
        const container = document.querySelector(`#${sectionId} .cards-container`);
        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
          <h3>${item.name || item.eventName}</h3>
          <p>${item.address || item.venue}</p>
          <p>${item.openingTime
                ? `<strong>Open:</strong> ${item.openingTime} - ${item.closingTime}`
                : `<strong>Start:</strong> ${item.date} @ ${item.startTime}`}
          </p>
          <p class="weather"><strong>Weather:</strong> ${weather.temperature}Â°C</p>
          <p>${item.cuisine || ''}</p>
        `;
            container.appendChild(card);
        });
    }
</script>
</body>
</html>